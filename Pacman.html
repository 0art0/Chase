<!DOCTYPE html>
<html lang="en">

<head>
    <style>
        body {
            margin: 50px;
            padding: 0 0 0 300px;
        }
    </style>

    <meta charset="UTF-8">

    <title>PAC-MAN</title>
</head>

<canvas id = "PacScreen" width = 500px height = 500px
        style="border:10px solid dimgray;" ></canvas>

<body>
<script id = "Pacman">
    var canvas = document.getElementById("PacScreen");
    var ctx = canvas.getContext("2d");

    var dotArray = [];
    var x = Math.round(canvas.width / 2);
    var y = Math.round(canvas.height / 2) - 75;

    initDotArray();
    placeBackground();
    placeDots();
    placePacman("r");

    document.onkeydown = checkKey;

    var open = true;
    var stage = 0;

    function checkKey(e) {
        clearCanvas();
        placeBackground();
        placeDots();
        ctx.moveTo(x, y);
        ctx.beginPath();
        //up
        if (e.keyCode == '38' || e.keyCode == '119' || e.keyCode == '87') {
            if (y > 25 && isOnTrack(x, y - 5)) y -= 5;
            open ? placePacman("u") : placePaclosed();
        }
        //down
        else if (e.keyCode == '40' || e.keyCode == '115' || e.keyCode == '83') {
            if (y < (canvas.height - 25) && isOnTrack(x, y + 5)) y += 5;
            open ? placePacman("d") : placePaclosed();
        }
        //left
        else if (e.keyCode == '37'  || e.keyCode == '97' || e.keyCode == '65') {
            if (x > 25 && isOnTrack(x - 5, y)) x -= 5;
            open ? placePacman("l") : placePaclosed();
        }
        //right
        else if (e.keyCode == '39' || e.keyCode == '100' || e.keyCode == '68') {
            if (x < (canvas.width - 25) && isOnTrack(x + 5, y)) x += 5;
            open ? placePacman("r") : placePaclosed();
        }
        else placePaclosed();
        eatDots();
        if (stage == 3) {
            open = !open;
            stage = 0;
        }
        stage++;

        if(dotArray.length == 0) alert("You win!");
    }

    function clearCanvas() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.beginPath();
    }

    function placePacman(dir) {
        ctx.moveTo(x, y);
        switch (dir) {
            case 'u':
                ctx.arc(x, y, 23, (1.75 * Math.PI), (1.25 * Math.PI));
                break;
            case 'd':
                ctx.arc(x, y, 23, (0.75 * Math.PI), (0.25 * Math.PI));
                break;
            case 'l':
                ctx.arc(x, y, 23, (1.25 * Math.PI), (0.75 * Math.PI));
                break;
            case 'r':
                ctx.arc(x, y, 23, (0.25 * Math.PI), (1.75 * Math.PI));
                break;
        }
        ctx.fillStyle = "yellow";
        ctx.lineTo(x, y);
        ctx.closePath();
        ctx.strokeStyle = "black";
        ctx.stroke();
        ctx.fill();
    }

    function placePaclosed() {
        ctx.fillStyle = "yellow";
        ctx.arc(x, y, 23, 0, (2 * Math.PI));
        ctx.strokeStyle = "black";
        ctx.stroke();
        ctx.fill();
    }

    function placeBackground() {
        ctx.fillStyle = "black";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = "gray";
        ctx.strokeStyle = "gray";
        //ctx.lineWidth = 10;
        ctx.fillRect(50, ((canvas.height / 2) - 50), canvas.width - 100, 100);
        ctx.fillRect(50, 50, (canvas.width / 2 - 75), 100);
        ctx.fillRect(50, canvas.height - 150, (canvas.width / 2 - 75), 100);
        ctx.fillRect(canvas.width / 2 + 25, 50, (canvas.width / 2 - 75), 100);
        ctx.fillRect((canvas.width / 2 + 25), canvas.height - 150,
                (canvas.width / 2 - 75), 100);

    }

    function distance(x1, y1, x2, y2) {
        return (Math.sqrt( Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2)));
    }

    function onLine(a, b, x1, y1, x2, y2){
        var dAC = distance(a, b, x1, y1);
        var dBC = distance(a, b, x2, y2);
        var dAB = distance(x1, y1, x2, y2);
        return (dAB == dBC + dAC);
    }

    function isOnTrack(a, b) {
        var l1 = onLine(a, b, 25, 25, 25, canvas.height - 25);
        var l2 = onLine(a, b, canvas.width - 25, 25, canvas.width - 25, canvas.height - 25);
        var l3 = onLine(a, b, 25, 25, canvas.width - 25, 25);
        var l4 = onLine(a, b, 25, canvas.height / 2 - 75, canvas.width - 25, canvas.height / 2 - 75);
        var l5 = onLine(a, b, 25, canvas.height / 2 + 75, canvas.width - 25, canvas.height / 2 + 75);
        var l6 = onLine(a, b, 25, canvas.height - 25, canvas.width - 25, canvas.height - 25);
        var l7 = onLine(a, b, canvas.width / 2, 25, canvas.width / 2, canvas.height / 2 - 75);
        var l8 = onLine(a, b, canvas.width / 2, canvas.height / 2 + 75, canvas.width / 2, canvas.height - 25);
        return (l1 || l2 || l3 || l4 || l5 || l6 || l7 || l8);
    }

    function initDotArray() {
        for (var i = 50; i <= canvas.width - 50; i += 25) {
            dotArray.push([i, 25]);
            dotArray.push([i, (canvas.height / 2) - 75]);
            dotArray.push([i, (canvas.height / 2) + 75]);
            dotArray.push([i, canvas.height - 25]);
        }
        for(var j = 25; j <= canvas.height - 25; j += 25) {
            dotArray.push([25, j]);
            dotArray.push([canvas.width - 25, j]);
        }
        for(var k = 50; k <= 150; k += 25) {
            dotArray.push([canvas.width / 2, k]);
            dotArray.push([canvas.width / 2, canvas.height - k]);
        }

        delElem([canvas.width / 2, 175]);
        delElem([canvas.width / 2 - 25, 175]);
        delElem([canvas.width / 2 + 25, 175]);
        delElem([canvas.width / 2, 150]);
    }

    function placeDots() {
        for(var i = 0; i < dotArray.length; i++)
        {
            var dotx = dotArray[i][0];
            var doty = dotArray[i][1];
            ctx.moveTo(dotx, doty);
            ctx.arc(dotx, doty, 2, 0, 2 * Math.PI);
        }
        ctx.strokeStyle = "yellow";
        ctx.stroke();
    }

    function delElem(elem) {
        for(var i = 0; i < dotArray.length; i++){
            if((elem[0] == dotArray[i][0]) && (elem[1] == dotArray[i][1])) {
                delete dotArray[i];
                dotArray.sort();
                dotArray.pop();
                break;
            }
        }

    }

    function eatDots() {
        for(var i = 0; i < dotArray.length; i++) {
            if((x == dotArray[i][0]) && y == (dotArray[i][1])) {
                delElem([dotArray[i][0], dotArray[i][1]]);
            }
        }
    }

</script>
</body>
</html>
