<!DOCTYPE html>
<html lang="en">

<head>
    <style>
        body {
            margin: 50px;
            padding: 0 0 0 300px;
        }
    </style>

    <meta charset="UTF-8">

    <title>PAC-MAN</title>
</head>

<canvas id = "PacScreen" width = 500px height = 500px
        style="border:10px solid blue;" ></canvas>

<body bgcolor="black">
<script id = "Pacman">
    var canvas = document.getElementById("PacScreen");
    var ctx = canvas.getContext("2d");

    var l = 500; // width/height of the canvas
    var x = 250;
    var y = 175;
    var dotArray = [];
    var powerDotArray = [[25, 75], [l - 25, 75], [25, l - 125], [l - 25, l - 125]];

    initDotArray();
    placeBackground();
    placeDots();
    checkKey('e');

    document.onkeydown = checkKey;
    var open = true;
    var stage = 0;

    function checkKey(e) {
        clearCanvas();
        placeBackground();
        placeDots();
        ctx.moveTo(x, y);
        ctx.beginPath();
        //up
        if (e.keyCode == '38' || e.keyCode == '119' || e.keyCode == '87') {
            if (y > 25 && isOnTrack(x, y - 5)) y -= 5;
            open ? placePacman("u") : placePaclosed();
        }
        //down
        else if (e.keyCode == '40' || e.keyCode == '115' || e.keyCode == '83') {
            if (y < (l - 25) && isOnTrack(x, y + 5)) y += 5;
            open ? placePacman("d") : placePaclosed();
        }
        //left
        else if (e.keyCode == '37'  || e.keyCode == '97' || e.keyCode == '65') {
            if (x > 25 && isOnTrack(x - 5, y)) x -= 5;
            open ? placePacman("l") : placePaclosed();
        }
        //right
        else if (e.keyCode == '39' || e.keyCode == '100' || e.keyCode == '68') {
            if (x < (l - 25) && isOnTrack(x + 5, y)) x += 5;
            open ? placePacman("r") : placePaclosed();
        }
        //reload
        else if(e.keyCode == '114' || e.keyCode == '82') {
            window.location.reload();
        }

        else placePaclosed();
        eatDots();
        eatPowerDots();
        if (stage == 3) {
            open = !open;
            stage = 0;
        }
        stage++;

        if(dotArray.length == 0 && powerDotArray.length == 0) {
            alert("You win!");
            window.location.reload();
        }
    }

    function clearCanvas() {
        ctx.clearRect(0, 0, l, l);
        ctx.beginPath();
    }

    function placePacman(dir) {
        ctx.moveTo(x, y);
        switch (dir) {
            case 'u':
                ctx.arc(x, y, 18, (1.75 * Math.PI), (1.25 * Math.PI));
                break;
            case 'd':
                ctx.arc(x, y, 18, (0.75 * Math.PI), (0.25 * Math.PI));
                break;
            case 'l':
                ctx.arc(x, y, 18, (1.25 * Math.PI), (0.75 * Math.PI));
                break;
            case 'r':
                ctx.arc(x, y, 18, (0.25 * Math.PI), (1.75 * Math.PI));
                break;
        }
        ctx.lineTo(x, y);
        ctx.closePath();
        ctx.lineWidth = 8;
        ctx.strokeStyle = "yellow";
        ctx.stroke();
        ctx.lineWidth = 1;
    }

    function placePaclosed() {
        ctx.fillStyle = "yellow";
        ctx.arc(x, y, 18, 0, (2 * Math.PI));
        ctx.fill();
    }

    function placeBackground() {
        ctx.fillStyle = "black";
        ctx.fillRect(0, 0, l, l);
        ctx.fillStyle = "gray";
        ctx.strokeStyle = "blue";
        ctx.lineWidth = 7;
        ctx.strokeRect(50, ((l / 2) - 50), l - 100, 100);
        ctx.strokeRect(50, 50, (l / 2 - 75), 100);
        ctx.strokeRect(50, l - 150, (l / 2 - 75), 100);
        ctx.strokeRect(l / 2 + 25, 50, (l / 2 - 75), 100);
        ctx.strokeRect((l / 2 + 25), l - 150,
                (l / 2 - 75), 100);
    }

    function distance(x1, y1, x2, y2) {
        return (Math.sqrt( Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2)));
    }

    function onLine(a, b, x1, y1, x2, y2) {
        return (distance(x1, y1, x2, y2) == distance(a, b, x2, y2) + distance(a, b, x1, y1));
    }

    function isOnTrack(a, b) {
        var onTrack = false;
        if(onLine(a, b, 25, 25, 25, l - 25)) onTrack = true;
        else if(onLine(a, b, l - 25, 25, l - 25, l - 25)) onTrack = true;
        else if(onLine(a, b, 25, 25, l - 25, 25)) onTrack = true;
        else if(onLine(a, b, 25, l / 2 - 75, l - 25, l / 2 - 75)) onTrack = true;
        else if (onLine(a, b, 25, l / 2 + 75, l - 25, l / 2 + 75)) onTrack  = true;
        else if (onLine(a, b, 25, l - 25, l - 25, l - 25)) onTrack = true;
        else if(onLine(a, b, l / 2, 25, l / 2, l / 2 - 75)) onTrack = true;
        else if(onLine(a, b, l / 2, l / 2 + 75, l / 2, l - 25)) onTrack = true;
        return onTrack;
    }

    function initDotArray() {
        for (var i = 50; i <= l - 50; i += 25) {
            dotArray.push([i, 25]);
            dotArray.push([i, (l / 2) - 75]);
            dotArray.push([i, (l / 2) + 75]);
            dotArray.push([i, l - 25]);
        }
        for(var j = 25; j <= l - 25; j += 25) {
            dotArray.push([25, j]);
            dotArray.push([l - 25, j]);
        }
        for(var k = 50; k <= 150; k += 25) {
            dotArray.push([l / 2, k]);
            dotArray.push([l / 2, l - k]);
        }

        delElem([l / 2, 175], dotArray);
        delElem([l / 2 - 25, 175], dotArray);
        delElem([l / 2 + 25, 175], dotArray);
        delElem([l / 2, 150], dotArray);

        delElem([25, 75], dotArray);
        delElem([l - 25, 75], dotArray);
        delElem([25, l - 125], dotArray);
        delElem([l - 25, l - 125], dotArray);
    }

    function placeDots() {
        for(var i = 0; i < dotArray.length; i++)
        {
            var dotx = dotArray[i][0];
            var doty = dotArray[i][1];
            ctx.moveTo(dotx, doty);
            ctx.arc(dotx, doty, 2, 0, 2 * Math.PI);
        }
        ctx.lineWidth = 2;
        ctx.strokeStyle = "white";
        ctx.stroke();
        ctx.lineWidth = 1;

        for(var j = 0; j < powerDotArray.length; j++) {
            var pdotx = powerDotArray[j][0];
            var pdoty = powerDotArray[j][1];
            ctx.moveTo(pdotx, pdoty);
            ctx.arc(pdotx, pdoty, 8, 0, 2 * Math.PI);
        }
        ctx.fillStyle = "orange";
        ctx.fill();
    }

    function delElem(elem, array) {
        for(var i = 0; i < array.length; i++) {
            if((elem[0] == array[i][0]) && (elem[1] == array[i][1])) {
                delete array[i];
                array.sort();
                array.pop();
                break;
            }
        }

    }

    function eatDots() {
        for(var i = 0; i < dotArray.length; i++) {
            if ((x == dotArray[i][0]) && y == (dotArray[i][1]))
                delElem([dotArray[i][0], dotArray[i][1]], dotArray);
        }
    }

    function eatPowerDots() {
        for (var i = 0; i < powerDotArray.length; i++) {
            if ((x == powerDotArray[i][0]) && y == (powerDotArray[i][1])) {
            delElem([powerDotArray[i][0], powerDotArray[i][1]], powerDotArray);
            //insert code for fright mode of monsters
            }
        }
    }

</script>
</body>
</html>
